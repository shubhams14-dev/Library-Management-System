<!DOCTYPE html>
<html lang="en" xmlns:th="http://www.thymeleaf.org">
<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1.0">
	<title>Advanced Search - Library Management System</title>
	<link href="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/css/bootstrap.min.css" rel="stylesheet">
	<link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css" rel="stylesheet">
	<style>
		  .bg-brown
		  { background-color: #46220a !important; }
		  .bg-lightgolden
		  { background-color: lightgoldenrodyellow !important; }
		  .search-form {
		      background-color: #f8f9fa;
		      border-radius: 10px;
		      padding: 25px;
		      box-shadow: 0 2px 4px rgba(0,0,0,0.1);
		  }
		  .form-section {
		      margin-bottom: 20px;
		  }
	</style>
</head>
<body>
	<nav class="navbar navbar-expand-lg navbar-dark bg-brown">
		<div class="container">
			<a class="navbar-brand" href="/"><i class="fas fa-book"></i> Library Management System</a>
			<button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarNav">
				<span class="navbar-toggler-icon"></span>
			</button>
			<div class="collapse navbar-collapse" id="navbarNav">
				<ul class="navbar-nav me-auto">
					<li class="nav-item"><a class="nav-link" href="/">Home</a></li>
					<li class="nav-item"><a class="nav-link" href="/search">Search</a></li>
					<li class="nav-item"><a class="nav-link active" href="/advanced-search">Advanced Search</a></li>
				</ul>
				<ul class="navbar-nav">
					<li class="nav-item" th:if="${user != null}"><a class="nav-link" href="/loans/my-loans"><i class="fas fa-book-reader"></i> My Loans</a></li>
					<li class="nav-item" th:if="${user != null}"><span class="navbar-text me-3">Welcome, <span th:text="${user.fullName}">User</span>!</span></li>
					<li class="nav-item" th:if="${user != null}"><a class="nav-link" href="/auth/logout"><i class="fas fa-sign-out-alt"></i> Logout</a></li>
					<li class="nav-item" th:unless="${user != null}"><a class="nav-link" href="/auth/login"><i class="fas fa-sign-in-alt"></i> Login</a></li>
				</ul>
			</div>
		</div>
	</nav>

	<main class="container py-4">
		<h1 class="mb-4"><i class="fas fa-search-plus"></i> Advanced Search</h1>

		<div class="search-form">
			<form action="/advanced-search" method="get">
				<div class="row">
					<div class="col-md-6 form-section">
						<label for="title" class="form-label"><i class="fas fa-book-open"></i> Title</label>
						<input type="text" class="form-control" id="title" name="title"
						       placeholder="Enter book title" th:value="${title}">
					</div>
					<div class="col-md-6 form-section">
						<label for="author" class="form-label"><i class="fas fa-user-edit"></i> Author</label>
						<input type="text" class="form-control" id="author" name="author"
						       placeholder="Enter author name" th:value="${author}">
					</div>
				</div>

				<div class="row">
					<div class="col-md-6 form-section">
						<label for="isbn" class="form-label"><i class="fas fa-barcode"></i> ISBN</label>
						<input type="text" class="form-control" id="isbn" name="isbn"
						       placeholder="Enter ISBN" th:value="${isbn}">
					</div>
					<div class="col-md-6 form-section">
						<label for="publisher" class="form-label"><i class="fas fa-building"></i> Publisher</label>
						<input type="text" class="form-control" id="publisher" name="publisher"
						       placeholder="Enter publisher name" th:value="${publisher}">
					</div>
				</div>

				<div class="row">
					<div class="col-md-4 form-section">
						<label for="status" class="form-label"><i class="fas fa-info-circle"></i> Status</label>
						<select class="form-select" id="status" name="status">
							<option value="">All Statuses</option>
							<option th:each="bookStatus : ${bookStatuses}"
							        th:value="${bookStatus.name()}"
							        th:text="${bookStatus.name()}"
							        th:selected="${status != null && status == bookStatus.name()}">
							</option>
						</select>
					</div>
					<div class="col-md-4 form-section">
						<label for="fromYear" class="form-label"><i class="fas fa-calendar-alt"></i> Publication Year From</label>
						<input type="number" class="form-control" id="fromYear" name="fromYear"
						       placeholder="e.g., 2000" min="1800" max="2025" th:value="${fromYear}">
					</div>
					<div class="col-md-4 form-section">
						<label for="toYear" class="form-label"><i class="fas fa-calendar-check"></i> Publication Year To</label>
						<input type="number" class="form-control" id="toYear" name="toYear"
						       placeholder="e.g., 2024" min="1800" max="2025" th:value="${toYear}">
					</div>
				</div>

				<div class="row mt-3">
					<div class="col-12">
						<button type="submit" class="btn btn-primary me-2">
							<i class="fas fa-search"></i> Search
						</button>
						<a href="/advanced-search" class="btn btn-secondary">
							<i class="fas fa-redo"></i> Reset
						</a>
					</div>
				</div>
			</form>
		</div>

		<hr class="my-4">

		<div th:if="${books != null}">
			<h3 class="mb-3">Search Results (<span th:text="${#lists.size(books)}">0</span> books found)</h3>

			<div class="row" th:if="${!books.empty}">
				<div class="col-md-6 col-lg-4 mb-4" th:each="book : ${books}">
					<div class="card h-100 bg-lightgolden">
						<div class="card-body position-relative">
							<span class="badge position-absolute top-0 end-0 mt-2 me-2"
							      th:classappend="${book.status.name() == 'AVAILABLE'} ? 'bg-success' : 'bg-warning'"
							      th:text="${book.status.name()}">AVAILABLE</span>
							<h5 class="card-title" th:text="${book.title}">Book Title</h5>
							<p class="card-text">
								<strong>Author:</strong> <span th:text="${book.author}">Author</span><br>
								<strong>ISBN:</strong> <span th:text="${book.isbn}">ISBN</span><br>
								<span th:if="${book.publisher != null}">
									<strong>Publisher:</strong> <span th:text="${book.publisher}">Publisher</span><br>
								</span>
								<span th:if="${book.publicationDate != null}">
									<strong>Publication Date:</strong> <span th:text="${#temporals.format(book.publicationDate, 'yyyy-MM-dd')}">Date</span>
								</span>
							</p>
							<a th:href="@{/books/{id}(id=${book.id})}" class="btn btn-primary">
								<i class="fas fa-eye"></i> View Details
							</a>
						</div>
					</div>
				</div>
			</div>

			<div class="alert alert-info" th:if="${books.empty}">
				<i class="fas fa-info-circle"></i> No books found matching your search criteria. Please try different filters.
			</div>
		</div>

		<div th:unless="${books != null}" class="alert alert-secondary">
			<i class="fas fa-hand-point-up"></i> Use the search form above to find books with specific criteria.
		</div>
	</main>

	<footer class="bg-light mt-5 py-4">
		<div class="container text-center">
			<p class="text-muted mb-0">&copy; 2025 Library Management System. All rights reserved.</p>
		</div>
	</footer>

	<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/js/bootstrap.bundle.min.js"></script>
</body>
</html>
